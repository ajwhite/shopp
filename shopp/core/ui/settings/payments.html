<div class="wrap">
	<h2>Payments Settings</h2>
	<?php include("navigation.html"); ?>

	<form name="settings" id="general" action="<?php echo $_SERVER['REQUEST_URI']; ?>" method="post">
		<table class="form-table"> 
			<tr class="form-field form-required"> 
				<th scope="row" valign="top"><label for="payment-gateway">Payment Gateway</label></th> 
				<td><select name="settings[payment_gateway]" id="payment-gateway">
					<option value="">Select One&hellip;</option>
					<?php echo menuoptions($gateways,$this->Settings->get('payment_gateway'),true)?>
					</select><br /> 
	            Select the payment gateway processor you will be using to process credit card transactions.</td>
			</tr>
			<tbody id="payment-settings">
			</tbody>
			<tr class="form-field form-required"> 
				<th scope="row" valign="top"><label for="paypalexpress-enabled">PayPal Express</label></th> 
				<td><input type="hidden" name="settings[PayPalExpress][enabled]" value="off" id="paypalexpress-disabled"/><input type="checkbox" name="settings[PayPalExpress][enabled]" value="on" id="paypalexpress-enabled"<?php echo ($PayPalExpress->settings['enabled'] == "on")?' checked="checked"':''; ?>/><label for="paypalexpress-enabled"> Enable PayPal Express</label>
					<div id="paypalexpress-settings">
						<?php echo $PayPalExpress->settings(); ?>
					</div>
					
					
				</td>
			</tr>
		</table>
		<p class="submit"><input type="submit" class="button" name="save" value="Save Changes" /></p>
	</form>
</div>

<script type="text/javascript">
(function($) {

if (!$('#paypalexpress-enabled').attr('checked')) $('#paypalexpress-settings').hide();

var gatewayHandlers = new CallbackRegistry();

var addSetting = function (label,field,help) {
	fieldtype = field.type;
	delete field.type;
	if (fieldtype == "text" || fieldtype == "password" || fieldtype == "select")
		help = '<br />'+help;
		
	if (fieldtype == "checkbox" || fieldtype == "radio")
		help = '<label for="'+field.id+'"> '+help+'</label>';
	
	var row = $('<tr></tr>').addClass('form-field').appendTo('#payment-settings');
	var heading = $('<th scope="row" valign="top"></th>').appendTo(row);
	var fieldLabel = $('<label></label>').attr('for',field.id).html(label).appendTo(heading);
	var dataCell = $('<td></td>').html(' '+help).appendTo(row);
	
	var input = $('<input type="'+fieldtype+'" />').attr(field).prependTo(dataCell);
	
	if (fieldtype == "checkbox")
		var hidden = $('<input type="hidden" name="'+field.name+'" value="'+field.unchecked+'" />').prependTo(dataCell);
	
}

<?php foreach ($Processors as $Processor) $Processor->settings(); ?>

$('#payment-gateway').change(function () {
	$('#payment-settings').empty();
	if (this.value.length > 0) gatewayHandlers.call(this.value);
});

if ($('#payment-gateway').val() != '') gatewayHandlers.call($('#payment-gateway').val());

$('#paypalexpress-enabled').change(function () {
	$('#paypalexpress-settings').slideToggle(250);
});

})(jQuery);
</script>